{{!-- Header with CSS --}}

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ book.title }}</title>
    <style type="text/css">
      body {
          font-family: sans-serif;

          /* Background pattern from Toptal Subtle Patterns
           * https://www.toptal.com/designers/subtlepatterns/ecailles/ */
          background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAUCAYAAADLP76nAAAA0UlEQVR42u2VSQqFMBBE6/5n6LN9ccDZqCjOwk8FPEEWyaIXRUL6daBpisLzPEIty4Ku65DnOdI0lbqupe97GccR53niui5KYuNxHAe2bcMwGJRliaIopG1bWJBv/ER4kmNjbDzsVLYwUJzQFed5FsoY4+rf5FRsPKqqIiT7vn9TcYVuRfZN1nUl6JrtGqPjkWUZp3Xw+76u4b5vNvDOdco0TWiaBr8kiY6Hn5nC855mCs/Dz0zheU8zhec9zRSe1yTWJNYk1iTWJNYk1iQOyf8BD7JVhlKAJvgAAAAASUVORK5CYII=)
      }

      #content {
        border: 3px solid #eaeaea;
        border-bottom: none;
        width: max-content;
        margin: 2em auto 0 auto;
        background-color: white;
      }

      @media (max-width: 1000px) {
        body { background: none; }
        #content { border: none; }
      }

      h1, h2, h3 { font-variant: small-caps; }

      a, a:link , a:visited , a:hover , a:active {
        color: blue;
        text-decoration: none;
      }

      .pad { padding: 2em; }
      .ws-pre { white-space: pre; }
      .faint { color: #999999; }
      .faint a, .faint a:link, .faint a:visited, .faint a:hover, .faint a:active { color: #999999; }

      header {
        text-align: center;
        margin: 7em 0 9em 0;
      }

      header .note {
        margin-top: 5em;
      }

      footer {
        display: block;
        width: max-content;
        margin: 0 auto 8em auto;
        padding: 0;
      }

      section.song { margin: 4em 0; }
      section.song h2 { text-decoration: underline; }
      section.song h4 { margin: 0; }
      .song-header {
        text-align: center;
        margin: 1em 0;
      }

      table.nospacing {border-collapse: collapse; }
      table.nospacing tr, table.nospacing td {
        margin: 0;
        padding: 0;
      }

      table.chord {
        display: inline-table;
        border-collapse: collapse;
        white-space: pre;
        vertical-align: bottom;
      }
      table.chord tr, table.chord td {
        margin: 0;
        padding: 0;
      }

      tr.verse-spacing { height: .75em; }

      tr.verse td {
        vertical-align: bottom;
      }

      td.verse-label {
        font-weight: bold;
      }

      tr.chord {
        font-weight: bold;
        color: red;
      }

      tr.chord-alt { color: blue; }

      .timesign {
        margin: .5em 0;
        font-size: 1.125em;
        font-family: serif;
      }

      hr.separator {
        border: none;
        border-top: 3px solid #eaeaea;
      }
    </style>
</head>

{{!-- HB inlines: Block types --}}

{{#*inline "verse-label"}}
  {{~#if verse}}{{verse}}.{{/if~}}
  {{~#if (contains this "chorus")}}{{@root.book.chorus_label}}{{chorus}}.{{/if~}}
  {{~#if custom}}{{custom}}{{/if~}}
{{/inline}}

{{#*inline "b-verse"}}
  {{#each paragraphs}}
  <tr class="verse-spacing"><td></td><td></td></tr>
    <tr class="verse">
      <td class="verse-label">
        {{~#if @first}}{{>verse-label ../label}}{{~/if}}
      </td>
      <td>{{#each this}}{{> (lookup this "type") }}{{/each}}</td>
    </tr>
    {{/each}}
{{/inline}}

{{#*inline "b-bullet-list"}}
  <tr>
    <td></td>
    <td><ul>{{#each items}}<li>{{ this }}</li>{{/each}}</ul></td>
  </tr>
{{/inline}}

{{#*inline "b-time-sign"}}
  TODO: TimeSign
  TODO: move to Song
{{/inline}}

{{#*inline "b-horizontal-line"}}
  <tr><td colspan="2"><hr></td></tr>
{{/inline}}

{{#*inline "b-pre"}}
  <tr>
    <td></td>
    <td><pre>{{ text }}</pre></td>
  </tr>
{{/inline}}


{{!-- HB inlines: Inline types --}}
{{!-- Warning: Inlines are sensitive about whitespace
  It's recommended to not insert any whitespace between the inline start & end
  tags and the content to prserve the right amount of whitespace --}}

{{#*inline "i-text"}}{{ text }}{{/inline}}

{{!-- FIXME: Comment --}}
{{#*inline "i-chord"}}<table class="chord">
  <tr class="chord"><td>{{ chord }}</td></tr>
  {{#if alt_chord}}<tr class="chord chord-alt ws-pre"><td>{{ alt_chord }}</td></tr>{{/if}}
  <tr><td>{{#each inlines}}{{> (lookup this "type") }}{{/each}}</td></tr>
</table>{{/inline}}

{{!-- Nb. the i-break element is a line separator, not terminator,
  ie. no i-break after the last inline element.
  That means we can break the current table cell/row and create a new one. --}}
{{#*inline "i-break"}}</td></tr><tr class="verse"><td class="verse-label"></td><td>{{/inline}}
{{#*inline "i-emph"}}<em>{{#each inlines}}{{> (lookup this "type") }}{{/each}}</em>{{/inline}}
{{#*inline "i-strong"}}<strong>{{#each inlines}}{{> (lookup this "type") }}{{/each}}</strong>{{/inline}}
{{#*inline "i-link"}}<a href="{{ url }}" title="{{ title }}">{{ text }}</a>{{/inline}}
{{#*inline "i-chorus-ref"}}{{ prefix_space }}{{ @root.book.chorus_label }}{{ num }}.{{/inline}}

{{!-- TODO: i-image, i-chorus-ref --}}

{{!-- Body - main structure --}}

<body>
<div id="content">
  <header class="pad">
    <h1>{{ book.title }}</h1>
    {{#if book.subtitle }}
      <h3>{{ book.subtitle }}</h3>
    {{/if }}
    {{#if book.title_note }}
      <p class="note">{{ book.title_note }}</p>
    {{/if }}
  </header>
  <hr class="separator">

  <div id="index" class="pad">
    <h2>Contents</h2>
    <ol>
    {{#each songs}}
      <li><a href="#song-{{ @index }}">{{ title }}</a></li>
    {{/each}}
    </ol>
  </div>

  <hr class="separator">
  {{#each songs}}
    <section id="song-{{ @index }}" class="song pad">
      <div class="song-header">
        <h2>{{ title }}</h2>
        {{#each subtitles}}<h4>{{ this }}</h4>{{/each}}
      </div>
      <table>
        {{#each blocks}}
          {{> (lookup this "type") }}
        {{/each}}
      </table>
    </section>
    <hr class="separator">
  {{/each}}

  {{#if book.backmatter}}
    <p class="pad">{{ book.backmatter }}</p>
    <hr class="separator">
  {{/if}}
</div>
<footer class="faint">
  Created with <strong><a href="{{ program.homepage }}">{{ program.name }}</a></strong> version {{ program.version }}.
</footer>
</body>
</html>

